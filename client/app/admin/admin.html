<div ng-include="'components/navbar/navbar.html'"></div>
<div class="container">
  <tabset>
    <tab heading="Users">
      <p>The delete user and user index api routes are restricted to users with the 'admin' role.</p>

      <div ng-show='updateUser'>
          <form name="userForm" ng-submit="userUpdate(userToUpdate)" novalidate>
              <div class="form-group">
                  <label>Email</label>
                  <input type="email" value ='{{userToUpdate.email}}' ng-model ='userToUpdate.email' class="form-control" ng-model="user.email" required>
              </div>

              <div class="form-group">
                  <label>Reset Password</label>
                  <input type="password" name="password" class="form-control" ng-model='userToUpdate.password'>
                  
              </div>

              <div class="form-group">
                  
                  <label>Confirm New Password</label>
                  <input type="password" name= 'confirm_password' class="form-control" ng-model="userToUpdate.confirmPassword" ui-validate="'$value==userToUpdate.password'" ui-validate-watch="'userToUpdate.password'" >
                  <div ng-show='!userForm.$valid && !!userForm.$error.validator && !userForm.confirm_password.$pristine'><span style='color:red'>Passwords Don't Match</span>
                  </div>
              </div>
              

              <div class='form-group'>
                <label>Permissions</label>
                <select ng-model='userToUpdate.role'>
                  <option ng-repeat='role in roles' >{{role.role}}</option>
                </select>


              </div>
              <button  class='btn btn-primary' ng-click='updateUser=false' ng-disabled='!userForm.$valid'>Save</button>
              <button type='button' class='btn btn-danger' ng-click='updateUser=false'>Cancel</button>

              <!-- <div class="form-group has-error">
                  <p class="help-block" ng-show="form.email.$error.required && form.password.$error.required && submitted">
                      Please enter your email and password.
                  </p>
                  <p class="help-block" ng-show="form.email.$error.email && submitted">
                      Please enter a valid email.
                  </p>

                  <p class="help-block">{{ errors.other }}</p>
              </div> -->
          </form>
      </div>




      <div ng-hide="updateUser">
        <ul class="list-group">
          <li class="list-group-item" ng-repeat="user in users">
            <span>
              <strong>{{user.name}}</strong>
              <a ng-click="$parent.updateUser=true; $parent.userToUpdate=user"><span class="glyphicon glyphicon-wrench pull-right"></a>
            </span> <br>
            <span class="text-muted">{{user.email}}</span>
            <a ng-click="deleteUser(user)" class="trash"><span class="glyphicon glyphicon-trash pull-right"></span></a><br>
            <span class='text-muted'>Permissions: {{user.role}}</span>
          </li>
        </ul>
    </div>
    </tab>
    <tab heading="Products">
      <button class='btn btn-primary' ng-click='addProduct = true' >Add Product</button>


       <!------- Add Product View ---->
      
      <div ng-show='addProduct'><h3>Add New Product</h3>
        <form name = 'productForm' ng-submit='createNewProduct(newProduct)'>
          <div ng-include="'components/filepicker/filepicker.html'"></div>
          <div class="form-group">
            <label class="col-sm-12 control-label">Product Name</label>
            <div class="col-sm-12">
              <input type="text" class="form-control" placeholder="product name" ng-model="newProduct.name">
            </div>
            <label class="col-sm-12 control-label">Product Description</label>
            <div class="col-sm-12">
              <input type="text" class="form-control" placeholder="product description" ng-model="newProduct.description">
            </div>
            <label class="col-sm-12 control-label">Price</label>
            <div class="col-sm-12">
              <input type="number" class="form-control" placeholder="price" ng-model="newProduct.price">
            </div>
            <label class="col-sm-12 control-label">Quantity</label>
            <div class="col-sm-12">
              <input type="number" class="form-control" placeholder="quantity" ng-model="newProduct.qty">
            </div>
            <label class="col-sm-12 control-label">Category</label>
            <div class="col-sm-10">
              <select class="form-control" ng-model='$parent.$parent.selectedCategory'>
                <option ng-repeat='category in categories' value='{{category.name}}'>{{category.name}}
                </option>
              </select>
            </div>

            <div class="col-sm-2">
              <button class='btn btn-primary btn-sm' type='button' ng-click="addCategory()">+</button>
            </div>
            <div class="col-sm-12">
              <ul>
                <li class="unstyle col-sm-2 " ng-repeat='category in newProduct.category'>
                    <button type='button' class='btn btn-danger btn-xs' ng-click='removeCategory(category)'>{{category}}</button>
                </li>
              </ul>
            </div>
            <div class="col-sm-12">
              <button type="submit" class="btn btn-primary" ng-click="addProduct=false">Save</button>
            </div>
            <div class="col-sm-12">
              <button ng-click='addProduct=!addProduct' type='button' class='btn btn-danger'>Cancel</button>
            </div>
          </div>
        </form>
      </div>  
      <!------- End Add Product View ---->


      <!---- Update Product View ------>
      <div ng-show="updateProduct"><h3>Update Product</h3>
        <form name = 'productForm' ng-submit='productUpdate(productToUpdate)'>
          <div class="form-group update-list">
            <div>{{productToUpdate.available ? "Available":"Unavailable"}}</div>
            <label class="col-sm-12 control-label">Product Name</label>
            <div class="col-sm-12">
              <input type="text" class="form-control" placeholder="product name" value="{{productToUpdate.name}}" ng-model="productToUpdate.name">
            </div>
            <label class="col-sm-12 control-label">Product Description</label>
            <div class="col-sm-12">
              <input type="text" class="form-control" placeholder="product name" value="{{productToUpdate.description}}" ng-model="productToUpdate.description">
            </div>
            <label class="col-sm-12 control-label">Price</label>
            <div class="col-sm-12">
              <input type="number" class="form-control" placeholder="price" value="{{productToUpdate.price}}" ng-model="productToUpdate.price">
            </div>
            {{productToUpdate}}
            <label class="col-sm-12 control-label">Quantity</label>
            <div class="col-sm-12">
              <input type="number" class="form-control" placeholder="quantity" value="{{productToUpdate.qty}}" ng-model="productToUpdate.qty">
            </div>
            <label class="col-sm-12 control-label">Category</label>
            <div class="col-sm-10">
              <select class="form-control" ng-model='$parent.$parent.selectedCategory'>
                <option ng-repeat='category in categories' value='{{category.name}}'>{{category.name}}
                </option>
              </select>
            </div>

            <div class="col-sm-2">
              <button class='btn btn-primary btn-sm' type='button' ng-click="addCategory()">+</button>
            </div>
            <div class="col-sm-12">
              <ul>
                <li class="unstyle col-sm-2 " ng-repeat='category in newProduct.category'>
                    <button type='button' class='btn btn-danger btn-xs' ng-click='removeCategory(category)'>{{category}}</button>
                </li>
              </ul>
            </div>
            <div class="btn-group col-sm-12">
              <button type="submit" class="btn btn-primary" ng-click="updateProduct=false">Update</button>
              <button ng-click='updateProduct=!updateProduct' type='button' class='btn btn-danger'>Cancel</button>
            </div>
            <div class='col-sm-12'>
              <button type='button' ng-click="productToUpdate.available=!productToUpdate.available" class='btn btn-warning'>{{productToUpdate.available ? "Make Unavailable":"Make Available"}}</button>
            </div>
          
          </div>
        </form>
      </div>

      <div ng-hide="updateProduct || addProduct">
        <ul class="list-group">
          <li  class="list-group-item" ng-repeat="product in products" ng-class="{unavailable:!product.available}">
            <span>
              <strong>{{product.name}}</strong> - {{product.available ? "Available":"Unvailable"}} 
              <a ng-click="$parent.updateProduct=true; $parent.productToUpdate=product"><span class="glyphicon glyphicon-wrench pull-right"></a>
            </span>
            <br>
            <span class="text-muted">{{product.description}}</span>
            <a ng-click="deleteProduct(product)" class="trash">
              <span class="glyphicon glyphicon-trash pull-right"> </span>
            </a>
            <br>
            <span class='text-muted'>Qty: {{product.qty}}</span>
          </li>
        </ul>
      </div>
    </tab>
    <tab heading="Orders">
      Orders
    </tab>
  </tabset>




</div>
